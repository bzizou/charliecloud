#!/bin/sh

libexec="$(cd "$(dirname "$0")" && pwd)"
. "${libexec}/base.sh"

# shellcheck disable=SC2034
usage=$(cat <<EOF
Wrapper for "docker build" with various enhancements.

Usage:

  $ $(basename "$0") -t TAG [ARGS ...] CONTEXT

ARGS are passed unchanged to "docker build" after the workaround arguments.
EOF
)

parse_basic_args "$@"

builder_choose
echo "building with: ${CH_BUILDER}"

case $CH_BUILDER in
    ch-grow)
        "${ch_bin}/ch-grow" "$@"
        ;;
    docker)
        # Coordinate this list with test "build.bats/proxy variables".
        # shellcheck disable=SC2154
        docker_ build --build-arg HTTP_PROXY="$HTTP_PROXY" \
                      --build-arg HTTPS_PROXY="$HTTPS_PROXY" \
                      --build-arg NO_PROXY="$NO_PROXY" \
                      --build-arg http_proxy="$http_proxy" \
                      --build-arg https_proxy="$https_proxy" \
                      --build-arg no_proxy="$no_proxy" \
                      "$@"
        ;;
esac
